<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkShift Pro - Учет смен</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#121212',
                            800: '#1E1E1E',
                            700: '#2D2D2D',
                            600: '#3A3A3A',
                            500: '#4A4A4A',
                        },
                        light: {
                            900: '#FFFFFF',
                            800: '#F8FAFC',
                            700: '#F1F5F9',
                            600: '#E2E8F0',
                            500: '#CBD5E1',
                        },
                        primary: {
                            DEFAULT: '#4F46E5',
                            600: '#4338CA',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="dark:bg-dark-900 bg-light-900 dark:text-gray-200 text-gray-800">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;
        // Инициализация IndexedDB
        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('WorkShiftDB', 3);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('shifts')) {
                        db.createObjectStore('shifts', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('areas')) {
                        db.createObjectStore('areas', { keyPath: 'id' });
                    }
                };
                
                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                request.onerror = (event) => {
                    reject('Error opening database');
                };
            });
        };

        // Сохранение данных в IndexedDB
        const saveData = async (storeName, data) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(`Error saving to ${storeName}`);
            });
        };

        // Получение данных из IndexedDB
        const getData = async (storeName, id) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(id);
                
                request.onsuccess = () => resolve(request.result?.value);
                request.onerror = () => reject(`Error getting from ${storeName}`);
            });
        };

        // Получение всех данных из хранилища
        const getAllData = async (storeName) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(`Error getting all from ${storeName}`);
            });
        };

        // Удаление данных из IndexedDB
        const deleteData = async (storeName, id) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(`Error deleting from ${storeName}`);
            });
        };

        // Основной компонент приложения
        function App() {
            const [shifts, setShifts] = useState([]);
            const [showShiftForm, setShowShiftForm] = useState(false);
            const [showAreaForm, setShowAreaForm] = useState(false);
            const [showAreaSettings, setShowAreaSettings] = useState(false);
            const [currentShiftId, setCurrentShiftId] = useState(null);
            const [currentAreaIndex, setCurrentAreaIndex] = useState(null);
            const [activeTab, setActiveTab] = useState('shifts');
            const [theme, setTheme] = useState('dark');
            const [savedAreas, setSavedAreas] = useState([]);
            
            // Загрузка данных и настроек при монтировании
            useEffect(() => {
                const loadData = async () => {
                    try {
                        // Загрузка смен
                        const db = await initDB();
                        const shiftsTransaction = db.transaction('shifts', 'readonly');
                        const shiftsStore = shiftsTransaction.objectStore('shifts');
                        const shiftsRequest = shiftsStore.getAll();
                        
                        shiftsRequest.onsuccess = () => {
                            setShifts(shiftsRequest.result || []);
                        };
                        
                        // Загрузка темы
                        const savedTheme = await getData('settings', 'theme');
                        if (savedTheme) {
                            setTheme(savedTheme);
                            document.documentElement.classList.add(savedTheme);
                        } else {
                            // Сохраняем тему по умолчанию
                            await saveData('settings', { id: 'theme', value: 'dark' });
                        }

                        // Загрузка сохраненных участков
                        const areas = await getAllData('areas');
                        setSavedAreas(areas);
                    } catch (error) {
                        console.error('Failed to load data:', error);
                    }
                };
                
                loadData();
            }, []);
            
            // Сохранение смены
            const saveShift = async (shift) => {
                try {
                    await saveData('shifts', shift);
                    setShifts(shifts.map(s => s.id === shift.id ? shift : s));
                } catch (error) {
                    console.error('Failed to save shift:', error);
                }
            };
            
            // Добавление новой смены
            const addShift = async (newShift) => {
                const shiftWithId = {
                    ...newShift,
                    id: Date.now().toString(),
                    areas: []
                };
                
                try {
                    await saveData('shifts', shiftWithId);
                    setShifts([...shifts, shiftWithId]);
                    setShowShiftForm(false);
                } catch (error) {
                    console.error('Failed to save shift:', error);
                }
            };
            
            // Добавление участка к смене
            const addAreaToShift = async (shiftId, newArea) => {
                const updatedShifts = shifts.map(shift => {
                    if (shift.id === shiftId) {
                        const workHours = calculateWorkHours(newArea.startTime, newArea.endTime);
                        return {
                            ...shift,
                            areas: [
                                ...(shift.areas || []), 
                                {
                                    ...newArea,
                                    workHours,
                                    payment: parseFloat(newArea.payment) || 0
                                }
                            ]
                        };
                    }
                    return shift;
                });
                
                try {
                    const updatedShift = updatedShifts.find(s => s.id === shiftId);
                    await saveShift(updatedShift);
                    setShifts(updatedShifts);
                    setShowAreaForm(false);
                } catch (error) {
                    console.error('Failed to update shift:', error);
                }
            };
            
            // Обновление участка в смене
            const updateAreaInShift = async (shiftId, areaIndex, updatedArea) => {
                const updatedShifts = shifts.map(shift => {
                    if (shift.id === shiftId) {
                        const workHours = calculateWorkHours(updatedArea.startTime, updatedArea.endTime);
                        const newAreas = [...shift.areas];
                        newAreas[areaIndex] = {
                            ...updatedArea,
                            workHours,
                            payment: parseFloat(updatedArea.payment) || 0
                        };
                        
                        return {
                            ...shift,
                            areas: newAreas
                        };
                    }
                    return shift;
                });
                
                try {
                    const updatedShift = updatedShifts.find(s => s.id === shiftId);
                    await saveShift(updatedShift);
                    setShifts(updatedShifts);
                    setShowAreaForm(false);
                } catch (error) {
                    console.error('Failed to update shift:', error);
                }
            };
            
            // Удаление смены
            const deleteShift = async (shiftId) => {
                try {
                    const db = await initDB();
                    const transaction = db.transaction('shifts', 'readwrite');
                    const store = transaction.objectStore('shifts');
                    const request = store.delete(shiftId);
                    
                    request.onsuccess = () => {
                        setShifts(shifts.filter(shift => shift.id !== shiftId));
                    };
                } catch (error) {
                    console.error('Failed to delete shift:', error);
                }
            };
            
            // Удаление участка
            const deleteArea = async (shiftId, areaIndex) => {
                const updatedShifts = shifts.map(shift => {
                    if (shift.id === shiftId) {
                        return {
                            ...shift,
                            areas: shift.areas.filter((_, index) => index !== areaIndex)
                        };
                    }
                    return shift;
                });
                
                try {
                    const updatedShift = updatedShifts.find(s => s.id === shiftId);
                    await saveShift(updatedShift);
                    setShifts(updatedShifts);
                } catch (error) {
                    console.error('Failed to update shift:', error);
                }
            };

            // Переключение темы
            const toggleTheme = async (newTheme) => {
                try {
                    await saveData('settings', { id: 'theme', value: newTheme });
                    setTheme(newTheme);
                    document.documentElement.classList.remove('dark', 'light');
                    document.documentElement.classList.add(newTheme);
                } catch (error) {
                    console.error('Failed to save theme:', error);
                }
            };

            // Добавление нового участка в настройки
            const addSavedArea = async (area) => {
                const areaWithId = {
                    ...area,
                    id: Date.now().toString()
                };
                
                try {
                    await saveData('areas', areaWithId);
                    setSavedAreas([...savedAreas, areaWithId]);
                } catch (error) {
                    console.error('Failed to save area:', error);
                }
            };

            // Удаление участка из настроек
            const deleteSavedArea = async (areaId) => {
                try {
                    await deleteData('areas', areaId);
                    setSavedAreas(savedAreas.filter(area => area.id !== areaId));
                } catch (error) {
                    console.error('Failed to delete area:', error);
                }
            };

            return (
                <div className="max-w-6xl mx-auto px-4 py-8">
                    <Header />
                    
                    <div className="mt-8 flex border-b dark:border-dark-700 border-light-600">
                        <TabButton 
                            active={activeTab === 'shifts'} 
                            onClick={() => setActiveTab('shifts')}
                            icon="calendar-day"
                        >
                            Мои смены
                        </TabButton>
                        <TabButton 
                            active={activeTab === 'stats'} 
                            onClick={() => setActiveTab('stats')}
                            icon="chart-bar"
                        >
                            Статистика
                        </TabButton>
                        <TabButton 
                            active={activeTab === 'settings'} 
                            onClick={() => setActiveTab('settings')}
                            icon="cog"
                        >
                            Настройки
                        </TabButton>
                    </div>
                    
                    <div className="mt-6">
                        {activeTab === 'shifts' && (
                            <ShiftsTab 
                                shifts={shifts} 
                                onAddShift={() => setShowShiftForm(true)}
                                onAddArea={(shiftId) => {
                                    setCurrentShiftId(shiftId);
                                    setCurrentAreaIndex(null);
                                    setShowAreaForm(true);
                                }}
                                onEditArea={(shiftId, areaIndex) => {
                                    setCurrentShiftId(shiftId);
                                    setCurrentAreaIndex(areaIndex);
                                    setShowAreaForm(true);
                                }}
                                onDeleteShift={deleteShift}
                                onDeleteArea={deleteArea}
                                theme={theme}
                                savedAreas={savedAreas}
                            />
                        )}
                        {activeTab === 'stats' && <StatsTab shifts={shifts} theme={theme} />}
                        {activeTab === 'settings' && (
                            <SettingsTab 
                                theme={theme} 
                                toggleTheme={toggleTheme} 
                                savedAreas={savedAreas}
                                onAddSavedArea={addSavedArea}
                                onDeleteSavedArea={deleteSavedArea}
                                showAreaSettings={showAreaSettings}
                                setShowAreaSettings={setShowAreaSettings}
                            />
                        )}
                    </div>
                    
                    {showShiftForm && (
                        <ShiftForm 
                            onAdd={addShift} 
                            onCancel={() => setShowShiftForm(false)} 
                            theme={theme}
                        />
                    )}
                    
                    {showAreaForm && (
                        <AreaForm 
                            shiftId={currentShiftId}
                            areaIndex={currentAreaIndex}
                            shift={shifts.find(s => s.id === currentShiftId)}
                            onAdd={addAreaToShift}
                            onUpdate={updateAreaInShift}
                            onCancel={() => setShowAreaForm(false)} 
                            theme={theme}
                            savedAreas={savedAreas}
                        />
                    )}
                </div>
            );
        }
        
        // Компонент заголовка
        function Header() {
            return (
                <header className="flex items-center justify-between">
                    <div className="flex items-center">
                        <div className="bg-primary-600 w-10 h-10 rounded-lg flex items-center justify-center">
                            <i className="fas fa-clock text-white text-xl"></i>
                        </div>
                        <h1 className="ml-3 text-2xl font-bold dark:text-gray-200 text-gray-800">WorkShift <span className="text-primary-600">Pro</span></h1>
                    </div>
                </header>
            );
        }
        
        // Компонент кнопки вкладки
        function TabButton({ children, active, onClick, icon }) {
            return (
                <button 
                    onClick={onClick}
                    className={`px-4 py-3 font-medium text-sm flex items-center ${active 
                        ? 'text-primary-600 border-b-2 border-primary-600' 
                        : 'dark:text-gray-500 text-gray-600 hover:dark:text-gray-300 hover:text-gray-800'}`}
                >
                    <i className={`fas fa-${icon} mr-2`}></i>
                    {children}
                </button>
            );
        }
        
        // Компонент вкладки "Мои смены"
        function ShiftsTab({ shifts, onAddShift, onAddArea, onEditArea, onDeleteShift, onDeleteArea, theme, savedAreas }) {
            // Форматируем дату в dd.mm.yyyy
            const formatDate = (dateString) => {
                if (!dateString) return '';
                const [year, month, day] = dateString.split('-');
                return `${day}.${month}.${year}`;
            };
            return (
                <div>
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-xl font-bold">История смен</h2>
                        <button 
                            onClick={onAddShift}
                            className="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg flex items-center"
                        >
                            <i className="fas fa-plus mr-2"></i>
                            Новая смена
                        </button>
                    </div>
                    
                    {shifts.length === 0 ? (
                        <div className="dark:bg-dark-800 bg-light-800 rounded-xl p-8 text-center">
                            <i className="fas fa-calendar text-5xl mb-4 dark:text-gray-500 text-gray-400"></i>
                            <h3 className="text-xl font-medium mb-2">Смены не добавлены</h3>
                            <p className="dark:text-gray-500 text-gray-600 mb-4">Начните добавлять свои смены для отслеживания работы и материалов</p>
                            <button 
                                onClick={onAddShift}
                                className="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg"
                            >
                                Добавить первую смену
                            </button>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {shifts.map(shift => (
                                <div key={shift.id} className="dark:bg-dark-800 bg-light-800 rounded-xl overflow-hidden shadow">
                                    <div className="flex justify-between items-center p-6 border-b dark:border-dark-700 border-light-600">
                                        <div>
                                            <h3 className="text-lg font-bold">{formatDate(shift.date)}</h3>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <button 
                                                onClick={() => onAddArea(shift.id)}
                                                className="dark:bg-dark-700 bg-light-700 hover:dark:bg-dark-600 hover:bg-light-600 px-3 py-1 rounded-lg text-sm flex items-center"
                                            >
                                                <i className="fas fa-plus mr-1"></i>
                                                Участок
                                            </button>
                                            <button 
                                                onClick={() => onDeleteShift(shift.id)}
                                                className="text-red-500 hover:text-red-400"
                                            >
                                                <i className="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {shift.areas?.length > 0 ? (
                                        <div className="divide-y dark:divide-dark-700 divide-light-600">
                                            {shift.areas.map((area, areaIndex) => (
                                                <div key={areaIndex} className="p-6">
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div>
                                                            <h4 className="font-medium">{area.name}</h4>
                                                            <p className="dark:text-gray-500 text-gray-600 text-sm">
                                                                {area.startTime} - {area.endTime} ({area.workHours} ч)
                                                            </p>
                                                            {area.description && (
                                                                <p className="dark:text-gray-500 text-gray-600 text-sm mt-1">
                                                                    {area.description}
                                                                </p>
                                                            )}
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <div className="text-green-500 font-medium">{area.payment} ₽</div>
                                                            <button 
                                                                onClick={() => onEditArea(shift.id, areaIndex)}
                                                                className="text-blue-500 hover:text-blue-400 ml-2"
                                                            >
                                                                <i className="fas fa-edit"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    {area.materials?.length > 0 && (
                                                        <div className="mt-4">
                                                            <h5 className="text-sm font-medium dark:text-gray-500 text-gray-600 mb-2">
                                                                <i className="fas fa-boxes mr-1"></i>
                                                                Материалы:
                                                            </h5>
                                                            <div className="dark:bg-dark-700 bg-light-700 rounded-lg p-3">
                                                                <div className="grid grid-cols-3 gap-2 text-sm font-medium dark:text-gray-400 text-gray-500 mb-2">
                                                                    <div>Название</div>
                                                                    <div>Количество</div>
                                                                    <div>Листы</div>
                                                                </div>
                                                                {area.materials.map((material, matIndex) => (
                                                                    <div key={matIndex} className="grid grid-cols-3 gap-2 py-1 border-b dark:border-dark-600 border-light-500 last:border-0">
                                                                        <div>{material.name}</div>
                                                                        <div>{material.quantity}</div>
                                                                        <div>{material.sheets || '-'}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    <div className="flex justify-end mt-3">
                                                        <button 
                                                            onClick={() => onDeleteArea(shift.id, areaIndex)}
                                                            className="text-red-500 hover:text-red-400 text-sm"
                                                        >
                                                            <i className="fas fa-trash mr-1"></i>
                                                            Удалить участок
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="p-6 text-center dark:text-gray-500 text-gray-600">
                                            <i className="fas fa-map-marked-alt mr-1"></i>
                                            Участки не добавлены
                                        </div>
                                    )}
                                    
                                    <div className="p-4 dark:bg-dark-700 bg-light-700 border-t dark:border-dark-600 border-light-500">
                                        <div className="flex justify-between font-medium">
                                            <span>Итого за смену:</span>
                                            <span className="text-green-500">
                                                {shift.areas?.reduce((sum, area) => sum + area.payment, 0).toFixed(2)} ₽
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }
        
        // Компонент вкладки "Статистика"
        function StatsTab({ shifts, theme }) {
            // Расчет общей статистики
            const totalStats = shifts.reduce((acc, shift) => {
                const shiftEarnings = shift.areas?.reduce((sum, area) => sum + area.payment, 0) || 0;
                const shiftHours = shift.areas?.reduce((sum, area) => sum + parseFloat(area.workHours), 0) || 0;
                
                return {
                    totalEarnings: acc.totalEarnings + shiftEarnings,
                    totalHours: acc.totalHours + shiftHours,
                    totalShifts: acc.totalShifts + 1,
                    totalAreas: acc.totalAreas + (shift.areas?.length || 0)
                };
            }, { totalEarnings: 0, totalHours: 0, totalShifts: 0, totalAreas: 0 });
            
            return (
                <div>
                    <h2 className="text-xl font-bold mb-6">Статистика</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <StatCard 
                            title="Всего смен" 
                            value={totalStats.totalShifts} 
                            icon="calendar-day" 
                            theme={theme}
                        />
                        <StatCard 
                            title="Всего часов" 
                            value={totalStats.totalHours.toFixed(2)} 
                            icon="clock" 
                            theme={theme}
                        />
                        <StatCard 
                            title="Всего участков" 
                            value={totalStats.totalAreas} 
                            icon="map-marked-alt" 
                            theme={theme}
                        />
                        <StatCard 
                            title="Общий заработок" 
                            value={`${totalStats.totalEarnings.toFixed(2)} ₽`} 
                            icon="money-bill-wave" 
                            theme={theme}
                        />
                    </div>
                    
                    <div className="dark:bg-dark-800 bg-light-800 rounded-xl p-6 shadow">
                        <h3 className="font-medium mb-4">
                            <i className="fas fa-history mr-2"></i>
                            Последние смены
                        </h3>
                        {shifts.length > 0 ? (
                            <div className="space-y-4">
                                {shifts.slice(0, 5).map(shift => (
                                    <div key={shift.id} className="flex justify-between items-center dark:bg-dark-700 bg-light-700 p-4 rounded-lg">
                                        <div>
                                            <div className="font-medium">
                                                <i className="fas fa-calendar-day mr-2"></i>
                                                {shift.date}
                                            </div>
                                            <div className="text-sm dark:text-gray-500 text-gray-600">
                                                {shift.areas?.length || 0} участков, {shift.areas?.reduce((sum, area) => sum + parseFloat(area.workHours), 0).toFixed(2)} ч
                                            </div>
                                        </div>
                                        <div className="text-green-500 font-medium">
                                            {shift.areas?.reduce((sum, area) => sum + area.payment, 0).toFixed(2)} ₽
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="text-center dark:text-gray-500 text-gray-600 py-8">
                                <i className="fas fa-database mr-2"></i>
                                Нет данных для отображения
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // Компонент карточки статистики
        function StatCard({ title, value, icon, theme }) {
            return (
                <div className="dark:bg-dark-800 bg-light-800 rounded-xl p-5 shadow">
                    <div className="flex justify-between items-start">
                        <div>
                            <h3 className="dark:text-gray-400 text-gray-600 text-sm">{title}</h3>
                            <p className="text-2xl font-bold mt-1">{value}</p>
                        </div>
                        <div className="dark:bg-dark-700 bg-light-700 p-3 rounded-lg text-xl">
                            <i className={`fas fa-${icon}`}></i>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Компонент вкладки "Настройки"
        function SettingsTab({ theme, toggleTheme, savedAreas, onAddSavedArea, onDeleteSavedArea, showAreaSettings, setShowAreaSettings }) {
            const [newAreaName, setNewAreaName] = useState('');
            
            const handleAddArea = () => {
                if (newAreaName.trim()) {
                    onAddSavedArea({
                        name: newAreaName.trim(),
                        description: ''
                    });
                    setNewAreaName('');
                }
            };
            
            return (
                <div>
                    <h2 className="text-xl font-bold mb-6">
                        <i className="fas fa-cog mr-2"></i>
                        Настройки
                    </h2>
                    
                    <div className="dark:bg-dark-800 bg-light-800 rounded-xl overflow-hidden shadow">
                        <div className="p-6 border-b dark:border-dark-700 border-light-600">
                            <h3 className="font-medium mb-4">
                                <i className="fas fa-user mr-2"></i>
                                Аккаунт
                            </h3>
                            <div className="space-y-3">
                                <button className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg">
                                    <i className="fas fa-user-edit mr-2"></i>
                                    Профиль
                                </button>
                                <button className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg">
                                    <i className="fas fa-bell mr-2"></i>
                                    Уведомления
                                </button>
                                <button className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg">
                                    <i className="fas fa-shield-alt mr-2"></i>
                                    Безопасность
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-6 border-b dark:border-dark-700 border-light-600">
                            <h3 className="font-medium mb-4">
                                <i className="fas fa-mobile-alt mr-2"></i>
                                Приложение
                            </h3>
                            <div className="space-y-3">
                                <div className="flex items-center justify-between p-3">
                                    <div>
                                        <i className="fas fa-moon mr-2"></i>
                                        Тёмная тема
                                    </div>
                                    <label className="relative inline-flex items-center cursor-pointer">
                                        <input 
                                            type="checkbox" 
                                            className="sr-only peer" 
                                            checked={theme === 'dark'}
                                            onChange={() => toggleTheme(theme === 'dark' ? 'light' : 'dark')}
                                        />
                                        <div className="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[1.5px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 dark:border-gray-600 peer-checked:bg-primary-600"></div>
                                    </label>
                                </div>
                                <button className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg">
                                    <i className="fas fa-language mr-2"></i>
                                    Язык
                                </button>
                                <button className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg">
                                    <i className="fas fa-database mr-2"></i>
                                    Резервные копии
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-6">
                            <h3 className="font-medium mb-4">
                                <i className="fas fa-map-marked-alt mr-2"></i>
                                Участки
                            </h3>
                            
                            <button 
                                onClick={() => setShowAreaSettings(!showAreaSettings)}
                                className="w-full text-left p-3 hover:dark:bg-dark-700 hover:bg-light-700 rounded-lg flex justify-between items-center"
                            >
                                <span>
                                    <i className="fas fa-map-marker-alt mr-2"></i>
                                    Управление участками
                                </span>
                                <i className={`fas fa-chevron-${showAreaSettings ? 'up' : 'down'}`}></i>
                            </button>
                            
                            {showAreaSettings && (
                                <div className="mt-4 space-y-4">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={newAreaName}
                                            onChange={(e) => setNewAreaName(e.target.value)}
                                            className="flex-1 dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                            placeholder="Название участка"
                                        />
                                        <button
                                            onClick={handleAddArea}
                                            className="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg"
                                        >
                                            <i className="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    
                                    {savedAreas.length > 0 ? (
                                        <div className="dark:bg-dark-700 bg-light-700 rounded-lg p-3">
                                            <div className="divide-y dark:divide-dark-600 divide-light-500">
                                                {savedAreas.map((area) => (
                                                    <div key={area.id} className="py-2 flex justify-between items-center">
                                                        <div>
                                                            <div className="font-medium">{area.name}</div>
                                                            {area.description && (
                                                                <div className="text-sm dark:text-gray-500 text-gray-600">{area.description}</div>
                                                            )}
                                                        </div>
                                                        <button
                                                            onClick={() => onDeleteSavedArea(area.id)}
                                                            className="text-red-500 hover:text-red-400"
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center dark:text-gray-500 text-gray-600 py-4">
                                            <i className="fas fa-map-marked-alt mr-2"></i>
                                            Нет сохраненных участков
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Компонент формы добавления смены
        function ShiftForm({ onAdd, onCancel, theme }) {
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                onAdd({
                    date
                });
            };
            
            return (
                <div className="fixed inset-0 dark:bg-black bg-gray-800 dark:bg-opacity-70 bg-opacity-80 flex items-center justify-center p-4 z-50">
                    <div className={`${theme === 'dark' ? 'bg-dark-800' : 'bg-light-800'} rounded-xl w-full max-w-md shadow-lg`}>
                        <div className="p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold">
                                    <i className="fas fa-plus-circle mr-2"></i>
                                    Новая смена
                                </h2>
                                <button onClick={onCancel} className="dark:text-gray-500 text-gray-600 hover:dark:text-gray-300 hover:text-gray-800">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">
                                            <i className="fas fa-calendar-day mr-2"></i>
                                            Дата
                                        </label>
                                        <input 
                                            type="date" 
                                            value={date}
                                            onChange={(e) => setDate(e.target.value)}
                                            className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="flex gap-3 pt-4">
                                        <button
                                            type="button"
                                            onClick={onCancel}
                                            className="flex-1 dark:bg-dark-700 bg-light-700 hover:dark:bg-dark-600 hover:bg-light-600 py-3 rounded-lg flex items-center justify-center"
                                        >
                                            <i className="fas fa-times mr-2"></i>
                                            Отмена
                                        </button>
                                        <button
                                            type="submit"
                                            className="flex-1 bg-primary-600 hover:bg-primary-700 py-3 rounded-lg flex items-center justify-center text-white"
                                        >
                                            <i className="fas fa-check mr-2"></i>
                                            Создать
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }
        
// Компонент формы добавления/редактирования участка
function AreaForm({ shiftId, areaIndex, shift, onAdd, onUpdate, onCancel, theme, savedAreas }) {
    const isEditing = areaIndex !== null;
    const areaData = isEditing ? shift.areas[areaIndex] : null;
    
    

    const [name, setName] = useState(areaData?.name || '');
    const [description, setDescription] = useState(areaData?.description || '');
    const [startTime, setStartTime] = useState(areaData?.startTime || '');
    const [endTime, setEndTime] = useState(areaData?.endTime || '');
    const [payment, setPayment] = useState(areaData?.payment || '');
    const [materials, setMaterials] = useState(areaData?.materials || [{ name: '', quantity: '', sheets: '' }]);
    const [selectedAreaId, setSelectedAreaId] = useState('');

    // При выборе сохраненного участка
    useEffect(() => {
        if (selectedAreaId) {
            const selectedArea = savedAreas.find(a => a.id === selectedAreaId);
            if (selectedArea) {
                setName(selectedArea.name);
                setDescription(selectedArea.description || '');
            }
        }
    }, [selectedAreaId, savedAreas]);

    const handleMaterialChange = (index, field, value) => {
        const newMaterials = [...materials];
        newMaterials[index][field] = value;
        setMaterials(newMaterials);
    };
    
    const addMaterialField = () => {
        setMaterials([...materials, { name: '', quantity: '', sheets: '' }]);
    };
    
    const removeMaterialField = (index) => {
        if (materials.length > 1) {
            const newMaterials = [...materials];
            newMaterials.splice(index, 1);
            setMaterials(newMaterials);
        }
    };
    
    const handleSubmit = (e) => {
        e.preventDefault();
        const area = {
            name,
            description,
            startTime,
            endTime,
            payment,
            materials: materials.filter(m => m.name)
        };
        
        if (isEditing) {
            onUpdate(shiftId, areaIndex, area);
        } else {
            onAdd(shiftId, area);
        }
    };
    
    return (
        <div className="fixed inset-0 dark:bg-black bg-gray-800 dark:bg-opacity-70 bg-opacity-80 flex items-center justify-center p-4 z-50">
            <div className={`${theme === 'dark' ? 'bg-dark-800' : 'bg-light-800'} rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto shadow-lg`}>
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold">
                            <i className="fas fa-map-marked-alt mr-2"></i>
                            {isEditing ? 'Редактировать участок' : 'Новый участок'}
                        </h2>
                        <button onClick={onCancel} className="dark:text-gray-500 text-gray-600 hover:dark:text-gray-300 hover:text-gray-800">
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form onSubmit={handleSubmit}>
                        <div className="space-y-4">
                            {!isEditing && savedAreas.length > 0 ? (
                                <div>
                                    <label className="block text-sm font-medium mb-1">
                                        <i className="fas fa-map-marker-alt mr-2"></i>
                                        Выберите участок
                                    </label>
                                    <select
                                        value={selectedAreaId}
                                        onChange={(e) => setSelectedAreaId(e.target.value)}
                                        className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                    >
                                        <option value="">-- Выберите участок --</option>
                                        {savedAreas.map(area => (
                                            <option key={area.id} value={area.id}>{area.name}</option>
                                        ))}
                                    </select>
                                </div>
                            ) : (
                                <div>
                                    <label className="block text-sm font-medium mb-1">
                                        <i className="fas fa-signature mr-2"></i>
                                        Название участка
                                    </label>
                                    <input 
                                        type="text" 
                                        value={name}
                                        onChange={(e) => setName(e.target.value)}
                                        className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                        required
                                        placeholder="Например: Кровельные работы"
                                    />
                                </div>
                            )}
                            
                            <div>
                                <label className="block text-sm font-medium mb-1">
                                    <i className="fas fa-align-left mr-2"></i>
                                    Описание (необязательно)
                                </label>
                                <textarea
                                    value={description}
                                    onChange={(e) => setDescription(e.target.value)}
                                    className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                    placeholder="Например: Установка кровли на доме №5"
                                    rows="3"
                                />
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div className="relative">
                                    <label className="block text-sm font-medium mb-1">
                                        <i className="fas fa-clock mr-2"></i>
                                        Начало (ч:мм)
                                    </label>
                                    <input 
                                        type="time" 
                                        value={startTime}
                                        onChange={(e) => setStartTime(e.target.value)}
                                        className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                        required
                                    />
                                    <div className="absolute left-3 top-9 text-gray-500">
                                        <i className="fas fa-clock"></i>
                                    </div>
                                </div>
                                <div className="relative">
                                    <label className="block text-sm font-medium mb-1">
                                        <i className="fas fa-clock mr-2"></i>
                                        Конец (ч:мм)
                                    </label>
                                    <input 
                                        type="time" 
                                        value={endTime}
                                        onChange={(e) => setEndTime(e.target.value)}
                                        className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                        required
                                    />
                                    <div className="absolute left-3 top-9 text-gray-500">
                                        <i className="fas fa-clock"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium mb-1">
                                    <i className="fas fa-money-bill-wave mr-2"></i>
                                    Оплата (₽)
                                </label>
                                <input 
                                    type="number" 
                                    value={payment}
                                    onChange={(e) => setPayment(e.target.value)}
                                    className="w-full dark:bg-dark-700 bg-light-700 border dark:border-dark-600 border-light-500 rounded-lg px-4 py-2 focus:outline-none focus:ring-1 focus:ring-primary-600"
                                    required
                                />
                            </div>
                            
                            <div className="mt-6">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="font-medium">
                                        <i className="fas fa-boxes mr-2"></i>
                                        Материалы
                                    </h3>
                                    <button 
                                        type="button"
                                        onClick={addMaterialField}
                                        className="text-primary-600 hover:text-primary-500 text-sm flex items-center"
                                    >
                                        <i className="fas fa-plus mr-1"></i>
                                        Добавить материал
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    {materials.map((material, index) => (
                                        <div key={index} className="relative dark:bg-dark-700 bg-light-700 p-4 rounded-lg border dark:border-dark-600 border-light-500">
                                            <div className="space-y-3">
                                                <div>
                                                    <label className="block text-xs font-medium mb-1 dark:text-gray-400 text-gray-600">
                                                        Название материала
                                                    </label>
                                                    <input 
                                                        type="text" 
                                                        value={material.name}
                                                        onChange={(e) => handleMaterialChange(index, 'name', e.target.value)}
                                                        className="w-full dark:bg-dark-600 bg-light-600 border dark:border-dark-500 border-light-400 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary-600"
                                                        placeholder="Название"
                                                    />
                                                </div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label className="block text-xs font-medium mb-1 dark:text-gray-400 text-gray-600">
                                                            Количество
                                                        </label>
                                                        <input 
                                                            type="text" 
                                                            value={material.quantity}
                                                            onChange={(e) => handleMaterialChange(index, 'quantity', e.target.value)}
                                                            className="w-full dark:bg-dark-600 bg-light-600 border dark:border-dark-500 border-light-400 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary-600"
                                                            placeholder="Кол-во"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium mb-1 dark:text-gray-400 text-gray-600">
                                                            Листы
                                                        </label>
                                                        <input 
                                                            type="text" 
                                                            value={material.sheets}
                                                            onChange={(e) => handleMaterialChange(index, 'sheets', e.target.value)}
                                                            className="w-full dark:bg-dark-600 bg-light-600 border dark:border-dark-500 border-light-400 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary-600"
                                                            placeholder="Листы"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                            {materials.length > 1 && (
                                                <button 
                                                    type="button"
                                                    onClick={() => removeMaterialField(index)}
                                                    className="absolute top-2 right-2 text-gray-500 hover:text-red-500"
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="flex gap-3 pt-6">
                                <button
                                    type="button"
                                    onClick={onCancel}
                                    className="flex-1 dark:bg-dark-700 bg-light-700 hover:dark:bg-dark-600 hover:bg-light-600 py-3 rounded-lg flex items-center justify-center"
                                >
                                    <i className="fas fa-times mr-2"></i>
                                    Отмена
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 bg-primary-600 hover:bg-primary-700 py-3 rounded-lg flex items-center justify-center text-white"
                                >
                                    <i className="fas fa-check mr-2"></i>
                                    {isEditing ? 'Сохранить изменения' : 'Сохранить участок'}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    );
}
        
        // Функция для расчета времени работы (с вычетом 1 часа на обед)
        const calculateWorkHours = (startTime, endTime) => {
            if (!startTime || !endTime) return 0;
            
            const start = new Date(`2000-01-01T${startTime}`);
            const end = new Date(`2000-01-01T${endTime}`);
            
            // Если время конца меньше времени начала, значит это ночная смена
            if (end < start) {
                end.setDate(end.getDate() + 1);
            }
            
            const diffMs = end - start;
            const hours = (diffMs / (1000 * 60 * 60));
            
            // Вычитаем 1 час на обед (но не меньше 0)
            const workHours = Math.max(hours - 1, 0);
            return workHours.toFixed(2);
        };
        
        // Рендерим приложение
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
